import{j as e}from"./jsx-runtime.D5qyYPMi.js";import{r as n}from"./index.CZlPm10g.js";import{u as E,d as O,g as S,a as k}from"./tasks.store.d6dfpnp8.js";import{J as I,A as g}from"./index.DOoKv-MU.js";import"./index.JOLg7cur.js";import"./index.DAwUGNE3.js";const F=({task:t,onClose:a,imgUser:o,token:h})=>{const{toggleShouldUpdateTasks:i}=E(),c=async f=>{const p=O(f,h);g.promise(p,{loading:"Eliminando tarea...",success:l=>{if(l.success)return i(!0),setTimeout(a,1500),"Tarea eliminada correctamente";throw new Error("Error al eliminar la tarea")},error:l=>l.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx(I,{position:"bottom-left",richColors:!0}),e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:max-w-md lg:max-w-lg bg-white rounded-xl shadow-lg",children:e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"mb-5 border-b-4 mx-auto flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl text-blue-400 leading-6 font-bold dark:text-purple-500",children:t.name}),e.jsx("button",{onClick:a,className:"text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-red-600 dark:hover:text-white",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold flex items-center gap-2",children:"Descripción"}),e.jsx("p",{className:"text-sm my-2 rounded-lg font-medium",children:t.description}),e.jsxs("div",{className:"flex flex-row gap-10",children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("h2",{className:"font-bold",children:"Fecha límite"}),e.jsx("p",{className:"text-sm my-2 rounded-lg font-medium py-2",children:t.due_date instanceof Date?t.due_date.toLocaleDateString():t.due_date})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h2",{className:"font-bold",children:"Prioridad"}),e.jsx("p",{className:"text-sm my-2 rounded-lg font-medium bg-green-500 p-2 text-white",children:t.priority})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h2",{className:"font-bold",children:"Estado"}),e.jsx("p",{className:"text-sm my-2 rounded-lg font-medium bg-purple-500 p-2 text-white",children:t.estado})]})]}),e.jsxs("div",{className:"flex justify-between items-center my-5 bg-gray-200 rounded-lg p-3",children:[e.jsx("h2",{className:"font-medium text-gray-500",children:"Encargado:"}),e.jsx("img",{className:"w-14 rounded-full",src:o,alt:"Assigned user"})]})]}),e.jsx("div",{className:"flex flex-row justify-end",children:e.jsx("button",{type:"button",className:"focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900",onClick:()=>c(t.task_id),children:"Eliminar"})})]})})})]})},G=({project_id:t,token:a})=>{const{shouldUpdateTasks:o,toggleShouldUpdateTasks:h}=E(),[i,c]=n.useState(null),[f,p]=n.useState(""),[l,j]=n.useState([]),[m,z]=n.useState({});n.useEffect(()=>{async function s(){const r=await S(t,a);r==null&&g.info("No hay tareas registradas en este proyecto."),j(r)}s()},[t,a,o]),n.useEffect(()=>{if(o){async function s(){const r=await S(t,a);j(r),h(!1)}s()}},[o,t,a]);const b=s=>l.filter(r=>r.estado===s),w=s=>(console.log(m),m[s]?e.jsx("img",{src:m[s],alt:"User",className:"w-10 h-10 rounded-full"}):null),v=(s,r)=>{s.dataTransfer.setData("itemID",String(r.task_id)),console.log(r.task_id)},N=(s,r)=>{p(m[r]),c(s)},C=()=>{c(null)},y=s=>{s.preventDefault()},D=async(s,r)=>{const x=parseInt(s.dataTransfer.getData("itemID"),10),_=l.findIndex(d=>d.task_id===x);if(_===-1)return;const T=l[_],{task_id:A,...U}=T,u={...U,estado:r,due_date:P(T.due_date)},L=l.map(d=>d.task_id===x?{...d,...u,due_date:T.due_date}:d);j(L);try{console.log(u);const d=await k(x,u,a);console.log(await k(x,u,a)),d.success?g.success("Tarea actualizada correctamente"):g.error("Error al actualizar la tarea")}catch(d){console.error("Failed to update task:",d)}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{position:"bottom-left",richColors:!0}),i&&e.jsx(F,{task:i,imgUser:f,token:a,onClose:C}),l!=null?e.jsxs("div",{className:"flex flex-wrap  gap-3 flex-col lg:flex-row p-2 ",children:[e.jsxs("div",{className:"backdrop-blur-sm flex-grow w-full lg:max-w-[32.5%] rounded-lg min-h-32 border-t-4 p-2  border-purple-400 shadow-sm ",children:[e.jsx("h3",{className:" text-purple-400 font-bold  text-2xl rounded-lg my-1  ",children:"Por Hacer"}),e.jsx("div",{className:"flex min-h-32 flex-col h-full",onDragOver:s=>y(s),onDrop:s=>D(s,"por hacer"),children:b("por hacer").map(s=>e.jsxs("div",{className:"rounded-lg bg-white my-2 p-2 flex justify-between items-center",draggable:"true",onDragStart:r=>v(r,s),onClick:()=>N(s,s.assigned_user_id),children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xl text-purple-400 font-bold  ",children:[" ",s.name]}),e.jsx("p",{className:"text-gray-500",children:s.description})]}),e.jsx("div",{children:w(s.assigned_user_id)})]},s.task_id))})]}),e.jsxs("div",{className:"backdrop-blur-sm min-h-32 flex-grow w-full lg:max-w-[32.5%] rounded-lg  border-t-4 p-2  border-blue-400",children:[e.jsx("h3",{className:" text-blue-400 font-bold  text-2xl rounded-lg my-1  ",children:"En Proceso"}),e.jsx("div",{className:"flex min-h-32 flex-col h-full",onDragOver:s=>y(s),onDrop:s=>D(s,"en proceso"),children:b("en proceso").map(s=>e.jsxs("div",{className:"rounded-lg bg-white my-2 p-2 flex justify-between items-center",draggable:"true",onDragStart:r=>v(r,s),onClick:()=>N(s,s.assigned_user_id),children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xl text-purple-400 font-bold  ",children:[" ",s.name]}),e.jsx("p",{className:"text-gray-500",children:s.description})]}),e.jsx("div",{children:w(s.assigned_user_id)})]},s.task_id))})]}),e.jsxs("div",{className:"backdrop-blur-sm min-h-32 flex-grow w-full lg:max-w-[32.5%] rounded-lg  border-t-4 p-2  border-green-400",children:[e.jsx("h3",{className:" text-green-400 font-bold  text-2xl rounded-lg my-1  ",children:"Completado"}),e.jsx("div",{className:"flex min-h-32 flex-col h-full",onDragOver:s=>y(s),onDrop:s=>D(s,"completado"),children:b("completado").map(s=>e.jsxs("div",{className:"rounded-lg bg-white my-2 p-2 flex justify-between items-center",draggable:"true",onDragStart:r=>v(r,s),onClick:()=>N(s,s.assigned_user_id),children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xl text-purple-400 font-bold  ",children:[" ",s.name]}),e.jsx("p",{className:"text-gray-500",children:s.description})]}),e.jsx("div",{children:w(s.assigned_user_id)})]},s.task_id))})]})]}):e.jsx("div",{className:"flex justify-center items-center w-full h-96",children:e.jsx("p",{className:"text-xl font-bold text-purple-600 bg-white p-3 rounded-lg",children:"No hay tareas registradas"})})]})};function P(t){return new Date(t).toISOString()}export{G as default};
